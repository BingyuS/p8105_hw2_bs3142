---
title: "p8105_hw2_bs3142"
author: "Bingyu Sun"
date: "9/30/2018"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

### Problem 1    NYC Transit Data


#### Section 1: Data Manipulation

**Data cleaning**

  * Retain line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance
  * Convert the entry variable from character to a logical variable 
    
```{r clean_my_nyc_transit_data}
my_nyc_transit_data = 
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>%
  select(line, station_name, station_latitude, station_longitude, route1:route11, entry, vending, entrance_type, ada) %>%
  mutate(entry = recode(entry, "YES" = TRUE, "NO" = FALSE))
```


**Summary**

1. Variables in the dataset
    * The dataset contains information about NYC transit, like station location, routes served in each station, station entrance type, vending, and ADA compliance. 
2. Data cleaning steps
    * I created a data frame for cleaning raw NYC Transit data. The dataset is imported using a relative path and names are cleaned by janitor function. Specific variables in the dateset are selected. Furthermore, the entry variable has been converted to a logical vector. The resulting dataset consists of `r nrow(my_nyc_transit_data)` rows by `r ncol(my_nyc_transit_data)` columns.
3. Data assessment
    * The data is untidy. There are 11 columns of route numbers that should be organized into a single column under route number with a corresponding column for route names.



#### Section 2: Data features

**1. How many distinct stations are there?**

```{r Distinct stations: both by line and by name}
distinct_my_nyc_transit_data = 
  my_nyc_transit_data %>%
  distinct(line, station_name, .keep_all = TRUE)

nrow(distinct_my_nyc_transit_data)
```

There are **465** distinct train stations.

**2. How many stations are ADA compliant?**

```{r Number of stations that are ADA compliant}
distinct_my_nyc_transit_data %>%
  filter(ada == "TRUE") %>%
  count
```

**84** of the 465 stations are ADA compliant.

**3. What proportion of station entrances / exits without vending allow entrance?**

```{r Proportion of station without vending allow entrance}
nrow(filter(my_nyc_transit_data, vending == "NO", entry == "TRUE")) / nrow(filter(my_nyc_transit_data, vending == "NO"))
```

**37.7%** of station without vending allow entrance.



#### Section 3: Reformat data


* Transform route number and route name to distinct variables 

```{r reformat my nyc transit data}
tidy_my_nyc_transit_data =
  my_nyc_transit_data %>%
  gather(key = "route_number", value = "route_name", route1:route11) %>%
  distinct(line, station_name, .keep_all = TRUE) %>%
  filter(route_name == "A") %>%
  filter(ada == "TRUE")
```

**How many distinct stations serve the A train? Of the stations that serve the A train, how many are ADA compliant?**

* There are **60** distinct stations serve Train A, and **17** of them are ADA compliant.

### Problem 2

Question 1
```{r}
my_wheel_data =
  readxl::read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 1, range = ("A2:N338")) %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(sports_balls = as.integer(sports_balls))
```

Question 2
```{r}
my_prcp_2017_data = 
  readxl::read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 4, skip = 1) %>%
  janitor::clean_names() %>%
  rename(precipitation_in = total) %>%
  mutate(year = "2017") %>%
  filter(!is.na(month), !is.na(precipitation_in))
```

```{r}
my_prcp_2016_data =
  readxl::read_excel("./data/HealthyHarborWaterWheelTotals2018-7-28.xlsx", sheet = 5, skip = 1) %>%
  janitor::clean_names() %>%
  rename(precipitation_in = total) %>%
  mutate(year = "2016") %>%
  filter(!is.na(month), !is.na(precipitation_in))
```

```{r}
my_combined_prcp_data =
  bind_rows(my_prcp_2016_data, my_prcp_2017_data) %>%
  mutate(month = month.name[month])
```

### Problem 3

```{r}
library(p8105.datasets)
data(brfss_smart2010)
```

```{r}
my_brfss_data = 
  brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  select(-(class:question), -sample_size, -(confidence_limit_low:geo_location)) %>%
  spread(key = response, value = data_value) %>%
  janitor::clean_names() %>%
  mutate(prop_excellent_and_very_good = (excellent + very_good))
```

```{r}
skimr::skim(my_brfss_data)
```

```{r}
hist_excellent_2002 = 
  select(my_brfss_data, year, excellent) %>%
  filter(year == "2002") %>%
  ggplot(aes(x = excellent)) +
  geom_histogram()
```

Scatterplot
```{r}
sp_excellent_nyc_qc_2002_2010 =
  select(my_brfss_data, year, locationdesc, excellent) %>%
  filter(locationdesc %in% c("NY - New York County", "NY - Queens County")) %>%
  ggplot(aes(x = year, y = excellent)) +
  geom_point()
```

